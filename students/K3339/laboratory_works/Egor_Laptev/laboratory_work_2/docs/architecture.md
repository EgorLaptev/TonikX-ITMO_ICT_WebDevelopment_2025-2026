# Архитектура системы

## Общая структура проекта

Проект построен на основе Django Framework и следует стандартной архитектуре MVC (Model-View-Template).

```
laboratory_work_2/
├── app/                    # Настройки Django проекта
│   ├── settings.py         # Конфигурация приложения
│   ├── urls.py            # Главный URL конфиг
│   └── wsgi.py            # WSGI конфигурация
├── racing/                 # Основное приложение
│   ├── models.py          # Модели данных
│   ├── views.py           # Представления (контроллеры)
│   ├── forms.py           # Формы
│   ├── admin.py           # Настройки админ-панели
│   ├── urls.py            # URL маршруты приложения
│   ├── templates/         # HTML шаблоны
│   └── migrations/        # Миграции базы данных
├── docs/                  # Документация MkDocs
├── docker-compose.yml     # Конфигурация Docker
├── requirements.txt       # Python зависимости
└── mkdocs.yml            # Конфигурация MkDocs
```

## Компоненты системы

### 1. Модели данных (Models)

Система использует следующие модели:

- **ParticipantProfile** - профиль участника гонок
- **Car** - информация об автомобилях
- **Race** - информация о гонках
- **Registration** - регистрации участников на гонки
- **Comment** - комментарии к гонкам

Подробное описание моделей см. в разделе [Модели данных](models.md).

### 2. Представления (Views)

#### Class-Based Views
- `RaceListView` - список гонок с пагинацией и поиском

#### Function-Based Views
- `race_detail` - детальная информация о гонке
- `register_for_race` - регистрация на гонку
- `edit_registration` - редактирование регистрации
- `cancel_registration` - удаление регистрации
- `add_comment` - добавление комментария
- `profile_view` - просмотр профиля
- `edit_profile` - редактирование профиля
- `add_car` - добавление автомобиля
- `leaderboard` - табло победителей
- `register_user` - регистрация пользователя
- `logout_user` - выход из системы

### 3. Формы (Forms)

- `ParticipantProfileForm` - форма редактирования профиля
- `RegistrationForm` - форма регистрации на гонку
- `CommentForm` - форма добавления комментария
- `CarForm` - форма добавления автомобиля
- `UserCreationForm` - форма регистрации пользователя (Django)

### 4. Шаблоны (Templates)

Все шаблоны используют базовый шаблон `base.html` и построены на Tailwind CSS и Bootstrap 5.

**Основные шаблоны:**
- `base.html` - базовый шаблон с навигацией
- `race_list.html` - список гонок
- `race_detail.html` - детальная страница гонки
- `register.html` - регистрация на гонку
- `edit_registration.html` - редактирование регистрации
- `login.html` - страница входа
- `register_user.html` - страница регистрации
- `profile.html` - профиль пользователя
- `edit_profile.html` - редактирование профиля
- `add_car.html` - добавление автомобиля
- `leaderboard.html` - табло победителей

## База данных

### Схема базы данных

Система использует PostgreSQL 15, запускаемый через Docker Compose.

**Связи между моделями:**

```
User (Django)
  └── ParticipantProfile (1:1)
       ├── Car (1:N)
       └── Registration (1:N)
            └── Race (N:1)
                 └── Comment (1:N)
                      └── User (N:1)
```

### Миграции

Все изменения в моделях отслеживаются через Django migrations. При первом запуске необходимо выполнить:

```bash
python manage.py migrate
```

## URL маршрутизация

### Главные URL (app/urls.py)
- `/admin/` - админ-панель Django
- `/` - приложение racing

### URL приложения (racing/urls.py)
- `/` - список гонок
- `/leaderboard/` - табло победителей
- `/race/<id>/` - детальная страница гонки
- `/race/<id>/register/` - регистрация на гонку
- `/registration/<id>/edit/` - редактирование регистрации
- `/registration/<id>/cancel/` - удаление регистрации
- `/race/<id>/comment/` - добавление комментария
- `/profile/` - профиль пользователя
- `/profile/edit/` - редактирование профиля
- `/car/add/` - добавление автомобиля
- `/login/` - вход в систему
- `/logout/` - выход из системы
- `/register/` - регистрация пользователя

## Аутентификация

Система использует встроенную систему аутентификации Django:

- Регистрация новых пользователей
- Вход в систему
- Выход из системы
- Защита страниц декоратором `@login_required`
- Автоматическое создание профиля участника при регистрации

## Админ-панель

Django Admin настроен для управления:

- Профилями участников
- Автомобилями
- Гонками
- Регистрациями (с возможностью указания времени и позиции)
- Комментариями

## Безопасность

- CSRF защита на всех формах
- Валидация данных на стороне сервера
- Защита от SQL-инъекций через ORM Django
- Аутентификация пользователей
- Проверка прав доступа к редактированию/удалению

